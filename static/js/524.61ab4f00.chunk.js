"use strict";(self.webpackChunktribal_frontend_typescript=self.webpackChunktribal_frontend_typescript||[]).push([[524],{1752:function(e,n,t){t.r(n),t.d(n,{default:function(){return G}});var r=t(7961),s=t(2791),a=t(6030),i=t(6871),o=t(1748),c=t(1413),u=t(5861),l=t(7757),d=t.n(l),p=t(9535),f=t(9439),v=t(2526),m=t(5913),h=t(5705),x=t(4387),b=t(8805),C=t(3168),_=t(7771),g=t(5481),j=t(184),k={id:"",name:"",role:"",email:"",phone:"",join_date:""},y=function(e){var n=e.initialValues,t=void 0===n?k:n,r=e.onSubmit,s=e.title,a=e.onCancel,i=e.submitButtonText,o=e.onDelete,u=e.canDeleteInMobile,l=void 0!==u&&u,d=e.cancelButtonText,p=void 0===d?"Cancel":d,y=e.deleteButtonText,w=void 0===y?"Delete":y,B=(0,x.X)(),T=(0,f.Z)(B,1)[0],Z=(0,C.$)(["translation"]).t,P=(0,h.TA)({initialValues:t,validationSchema:b.Ry({name:b.Z_().required((0,g.j)(Z).fields.required),role:b.Z_(),email:b.Z_().required((0,g.j)(Z).fields.required).email((0,_.M)(Z).fields.invalidEmail),phone:b.Z_(),join_date:b.hT().when((function(e,n){return e&&n.max(new Date,(0,_.M)(Z).fields.dateShouldBeInPast)}))}),onSubmit:function(e){return r(e)}});return(0,j.jsxs)("div",{className:"o-personForm","data-v-b73f696f":"",children:[(0,j.jsx)("h3",{className:"o-personForm__title","data-v-b73f696f":"",children:s}),(0,j.jsxs)("form",{onSubmit:P.handleSubmit,"data-v-b73f696f":"",children:[(0,j.jsx)(m.I,(0,c.Z)((0,c.Z)({formik:P,type:"text",labelText:(0,_.M)(Z).fields.personName,id:"name"},P.getFieldProps("name")),{},{"data-v-b73f696f":""})),(0,j.jsx)(m.I,(0,c.Z)((0,c.Z)({formik:P,type:"text",labelText:(0,_.M)(Z).fields.role,id:"role"},P.getFieldProps("role")),{},{"data-v-b73f696f":""})),(0,j.jsx)(m.I,(0,c.Z)((0,c.Z)({formik:P,type:"email",labelText:(0,_.M)(Z).fields.email,id:"email"},P.getFieldProps("email")),{},{"data-v-b73f696f":""})),(0,j.jsx)(m.I,(0,c.Z)((0,c.Z)({formik:P,type:"tel",labelText:(0,_.M)(Z).fields.phone,id:"phone"},P.getFieldProps("phone")),{},{"data-v-b73f696f":""})),(0,j.jsx)(m.I,(0,c.Z)((0,c.Z)({formik:P,type:"date",labelText:(0,_.M)(Z).fields.joinDate,id:"join_date"},P.getFieldProps("join_date")),{},{"data-v-b73f696f":""})),(0,j.jsxs)("div",{className:"o-personForm__buttons","data-v-b73f696f":"",children:[!T&&(0,j.jsx)(v.z,{type:"button",onClick:a,backgroundColor:"#F8F8F8",textColor:"Black","data-v-b73f696f":"",children:p}),T&&l&&(0,j.jsx)(v.z,{type:"button",onClick:o,backgroundColor:"#F8F8F8",textColor:"#E32900",border:"solid 1px #E32900","data-v-b73f696f":"",children:w}),(0,j.jsx)(v.z,{type:"submit","data-v-b73f696f":"",children:i})]})]})]})},w=t(1266),B=t(4270),T=t(1830),Z=t.n(T),P=t(8086),F=t.n(P),V=t(1659),D=t(1105),E=F()(Z()),H=function(e){return function(){var n=(0,u.Z)(d().mark((function n(t,r){var s;return d().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(t(I(!0)),r().businesses.data.find((function(n){return n.id===e}))){n.next=6;break}return n.next=5,t((0,o.tB)(e));case 5:n.sent;case 6:return n.next=8,t(L(e));case 8:s=n.sent,t(R(s)),t(I(!1));case 11:case"end":return n.stop()}}),n)})));return function(e,t){return n.apply(this,arguments)}}()},I=function(e){return{type:B.V.updateLoadingPersons,payload:e}},L=function(e){return function(){var n=(0,u.Z)(d().mark((function n(t,r){var s,a;return d().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,w.b.get("business/".concat(e,"/persons"));case 3:return s=n.sent.data.persons,a=s.map((function(e){var n=e.personId;return delete e.personId,(0,c.Z)({id:n},e)})),n.abrupt("return",a);case 8:n.prev=8,n.t0=n.catch(0),console.log(n.t0);case 11:case"end":return n.stop()}}),n,null,[[0,8]])})));return function(e,t){return n.apply(this,arguments)}}()},R=function(e){return{type:B.V.setCurrentPerson,payload:e}},S=function(e){return function(){var n=(0,u.Z)(d().mark((function n(t,r){var s,a;return d().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,s=function(){return new Promise((function(n,t){E.fire({html:(0,j.jsx)(p.B,{cancelButtonText:(0,V.H)(D.t).general.cancel,confirmText:(0,V.H)(D.t).general.deleteConfirm,elementName:e.name,onConfirmClick:function(){n({isConfirmed:!0})},onCancel:function(){E.close()}}),showConfirmButton:!1,target:".App",showClass:{popup:"animate__animated animate__fadeInRight animate__faster"},hideClass:{popup:"animate__animated animate__fadeOutLeft animate__faster"},customClass:{htmlContainer:"--responsive"}})}))},n.next=4,s();case 4:if(!n.sent.isConfirmed){n.next=12;break}return console.log(r),a=r().businesses.currentBusiness.id,console.log(a),n.next=10,(0,w.b)("/business/".concat(a,"/persons/").concat(e.id),{method:"DELETE",headers:{"Content-Type":"application/json"}});case 10:Z().fire((0,V.H)(D.t).general.deleted,(0,V.H)(D.t).persons.deleted,"success"),t(M(e.id));case 12:n.next=17;break;case 14:n.prev=14,n.t0=n.catch(0),console.log(n.t0);case 17:case"end":return n.stop()}}),n,null,[[0,14]])})));return function(e,t){return n.apply(this,arguments)}}()},M=function(e){return{type:B.V.removePerson,payload:e}},N=function(e){return{type:B.V.updatePerson,payload:e}},A=function(e){return{type:B.V.updatePersons,payload:e}},O=t(5206),q=t(5289),z=t(3939),Q=t(5200),U=function(e){var n=e.title,t=e.persons,r=e.handleUpdateView,s=e.currentView,a=e.handleDelete,i=e.handleEditBusiness,o=e.handleEditPerson,c=e.handleCreate,u=e.isLoading,l=e.handleRefresh,d=e.staticData,p=(0,x.X)(),m=(0,f.Z)(p,1)[0],h=function(){r(0===s?1:0)};return(0,j.jsx)("div",{className:m?"t-complexCrud --mobile":"t-complexCrud","data-v-7146211c":"",children:(0,j.jsxs)(Q.r,{"data-v-7146211c":"",children:[(0,j.jsx)(q.y,{responsive:!0,title:n,actions:(0,j.jsxs)(j.Fragment,{children:[!m&&(0,j.jsx)(z.Q,{src:"/icons/refresh.svg",style:{cursor:"pointer"},onClick:l,"data-v-7146211c":""}),m&&(0,j.jsx)(z.Q,{src:"/icons/pen2.svg",onClick:function(){return i()},"data-v-7146211c":""}),!m&&(0,j.jsx)(z.Q,{src:"".concat(0===s?"/icons/squares.svg":"/icons/list.svg"),onClick:h,style:{cursor:"pointer"},"data-v-7146211c":""}),!m&&(0,j.jsx)(v.z,{onClick:function(){return c()},"data-v-7146211c":"",children:d.persons.actions.create})]}),"data-v-7146211c":"",children:m&&(0,j.jsx)(q.y,{title:d.persons.title,actions:(0,j.jsx)(j.Fragment,{children:(0,j.jsx)(z.Q,{src:"".concat(0===s?"/icons/squares.svg":"/icons/list.svg"),onClick:h,"data-v-7146211c":""})}),"data-v-7146211c":""})}),(0,j.jsx)(O.$,{canDelete:!m,data:t,currentView:s,handleDelete:a,handleEdit:o,isLoading:u,editIconName:m?"pen2":"pen","data-v-7146211c":""}),m&&(0,j.jsx)("div",{className:"t-complexCrud__button","data-v-7146211c":"",children:(0,j.jsx)(v.z,{onClick:c,"data-v-7146211c":"",children:d.persons.actions.create})})]})})},J=t(873),$=function(e){var n=(0,J.L)(e),t=(0,g.j)(e);return{title:n.title,actions:{create:n.actions.create,edit:n.actions.edit,delete:n.actions.delete,back:t.actions.back},responses:{created:n.responses.created,deleted:n.responses.deleted}}},X=function(e){var n=(0,_.M)(e);return{title:n.title,actions:{create:n.actions.create}}},K=function(e){return{business:$(e),persons:X(e)}},G=function(){var e=(0,i.UO)().id,n=(0,a.I0)(),t=(0,i.s0)(),c=(0,C.$)(["translation"]).t;(0,s.useEffect)((function(){return e&&(n((0,o.Km)(e)),n(H(e))),function(){n((0,o.DJ)(null)),n(R([]))}}),[e,n]);var l=(0,a.v9)((function(e){var n;return null===e||void 0===e||null===(n=e.businesses)||void 0===n?void 0:n.currentBusiness})),p=(0,s.useRef)(!0);(0,s.useLayoutEffect)((function(){p.current?p.current=!1:0===Object.entries(l).length&&t("/")}),[l,t]);var f=(0,a.v9)((function(e){var n,t;return null===e||void 0===e||null===(n=e.businesses)||void 0===n||null===(t=n.currentBusiness)||void 0===t?void 0:t.name})),v=(0,a.v9)((function(e){var n;return null===e||void 0===e||null===(n=e.persons)||void 0===n?void 0:n.currentPersons})),m=(0,a.v9)((function(e){var n;return null===e||void 0===e||null===(n=e.ui)||void 0===n?void 0:n.currentView})),h=(0,a.v9)((function(e){var n;return null===e||void 0===e||null===(n=e.businesses)||void 0===n?void 0:n.isLoading})),x=(0,a.v9)((function(e){var n;return null===e||void 0===e||null===(n=e.persons)||void 0===n?void 0:n.isLoading})),b=(0,a.v9)((function(e){var n,t;return null===e||void 0===e||null===(n=e.businesses)||void 0===n||null===(t=n.currentBusiness)||void 0===t?void 0:t.id}));return(0,j.jsx)(r.n,{onButtonClick:function(){return t("/overview")},goBackText:K(c).business.actions.back,children:(0,j.jsx)(U,{title:f,persons:v,handleUpdateView:function(e){return n(function(e){return{type:B.V.updateCurrentView,payload:e}}(e))},currentView:m,handleCreate:function(){return n(function(){var e=(0,u.Z)(d().mark((function e(n,t){var s,a,i;return d().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,s=t().businesses.currentBusiness.id,e.next=4,new Promise((function(e,n){E.fire({html:(0,j.jsx)(r.n,{goBackText:(0,V.H)(D.t).business.back,onButtonClick:function(){E.close()},children:(0,j.jsx)(y,{title:(0,V.H)(D.t).persons.create,submitButtonText:(0,V.H)(D.t).persons.create,cancelButtonText:(0,V.H)(D.t).business.cancel,onSubmit:function(n){e(n)},onCancel:function(){E.close()}})}),showConfirmButton:!1,target:".App",showClass:{popup:"animate__animated animate__fadeInRight animate__faster"},hideClass:{popup:"animate__animated animate__fadeOutLeft animate__faster"}})}));case 4:return a=e.sent,e.next=7,(0,w.b)("/business/".concat(s,"/persons"),{method:"POST",data:JSON.stringify(a),headers:{"Content-Type":"application/json"}});case 7:return e.next=9,n(L(s));case 9:i=e.sent,n(A(i)),E.close(),Z().fire({icon:"success",title:(0,V.H)(D.t).persons.created,timer:1500,target:".App",customClass:{popup:"--responsiveResponse"}}),e.next=18;break;case 15:e.prev=15,e.t0=e.catch(0),Z().fire({icon:"error",title:"Error",text:"error",showConfirmButton:!0,timer:1500,target:".App",customClass:{popup:"--responsiveResponse"}});case 18:case"end":return e.stop()}}),e,null,[[0,15]])})));return function(n,t){return e.apply(this,arguments)}}())},handleDelete:function(e){return n(S(e))},handleEditBusiness:function(e){return n((0,o.AF)(e))},isLoading:h||x,handleEditPerson:function(e){return n(function(e){return function(){var n=(0,u.Z)(d().mark((function n(t,s){var a,i,o;return d().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,a=s().businesses.currentBusiness.id,i=function(){var n=(0,u.Z)(d().mark((function n(){return d().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,new Promise((function(n,s){E.fire({html:(0,j.jsx)(r.n,{onButtonClick:function(){E.close()},goBackText:(0,V.H)(D.t).business.back,children:(0,j.jsx)(y,{cancelButtonText:(0,V.H)(D.t).general.cancel,deleteButtonText:(0,V.H)(D.t).general.delete,onDelete:function(){return t(S(e))},canDeleteInMobile:!0,initialValues:e,title:(0,V.H)(D.t).persons.edit,submitButtonText:(0,V.H)(D.t).general.save,onSubmit:function(e){n(e)},onCancel:function(){E.close()}})}),showConfirmButton:!1,target:".App",showClass:{popup:"animate__animated animate__fadeInRight animate__faster"},hideClass:{popup:"animate__animated animate__fadeOutLeft animate__faster"}})}));case 2:return n.abrupt("return",n.sent);case 3:case"end":return n.stop()}}),n)})));return function(){return n.apply(this,arguments)}}(),n.next=5,i();case 5:return o=n.sent,n.next=8,(0,w.b)("/business/".concat(a,"/persons/").concat(e.id),{method:"PUT",data:JSON.stringify(o),headers:{"Content-Type":"application/json"}});case 8:t(N(o)),E.close(),Z().fire({icon:"success",title:(0,V.H)(D.t).persons.updated,showConfirmButton:!1,target:".App",timer:1500,customClass:{popup:"--responsiveResponse"}}),n.next=16;break;case 13:n.prev=13,n.t0=n.catch(0),Z().fire({icon:"error",title:"Error",text:"error",showConfirmButton:!0,target:".App",timer:1500,customClass:{popup:"--responsiveResponse"}});case 16:case"end":return n.stop()}}),n,null,[[0,13]])})));return function(e,t){return n.apply(this,arguments)}}()}(e))},handleRefresh:function(){return n(H(b))},staticData:K(c)})})}}}]);
//# sourceMappingURL=524.61ab4f00.chunk.js.map